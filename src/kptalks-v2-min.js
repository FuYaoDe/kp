(function(d){function g(b){var a='<div id="kp_come_container" style="width:'+b.width+"px; height:"+b.height+"px; left:-"+b.width+'px; bottom:0;"><img src="'+b.image+'" style="width:'+b.width+"px; height:"+b.height+'px;"><div id="kp_popup" style="left:'+.8*b.width+"px;top:"+.28*b.height+'px;"><div id="kp_says">'+b.default_text+'</div><div id="kp_popup_arrow_shadow"></div><div id="kp_popup_arrow"></div><div id="kx_close_popup">X</div></div></div>';d("body").append(a);h(b)}function h(b){var a={},e;d.get(b.api,
function(c){var f=0;d.each(c.data,function(c,b){a[f]=b;f++});c=a[Math.floor(Math.random()*(f-1))];link='<a href="'+c.url+'" target="_blank" class="kp_readmore">\u4e86\u89e3\u66f4\u591a\u67ef\u6587\u54f2\u7684\u653f\u898b</a>';title=c.title.replace(/\u3010\u67efp\u65b0\u653f\u3011/g,"");c=c.content.replace(/\u67ef\u6587\u54f2/g,"\u6211").replace(/\u53f0\u5317\u5e02\u9577\u53c3\u9078\u4eba/g,"").replace(/\u6211\u8868\u793a/g,"\u6211\u8a8d\u70ba").replace(/\u6211\u6307\u51fa/g,"\u6211\u8a8d\u70ba");
c=c.split("</p>");e=void 0==c[1]?'<p id="kp_say_bighi">'+b.default_text+"<br>\u6211\u63d0\u51fa<br>\u300c"+title.substring(2)+"\u300d</p>"+link:'<p id="kp_say_hi">'+b.default_text+"</p>"+c[1]+"..."+link+"</p>";d("#kp_says").html(e).promise().done(function(){d("p").removeAttr("style");d("span").removeAttr("style")})})}d.kptalks=function(b){var a=d.extend({image:"http://unlimited.kptaipei.tw/images/kp.png",api:"http://api.kptaipei.tw/v1/category/40?accessToken=kp53f568e77303e9.28212837",default_text:"\u4f60\u597d\uff0c\u6211\u662f\u67ef\u6587\u54f2",
effect:"default",height:450,width:466,left:-130},b);g(a);var e=d("#kp_come_container");b=d("#kp_come_container img");var c=d("#kp_popup"),f=d("#kx_close_popup");d(window).scroll(function(){var b=d(window).scrollTop(),f=d(window).height(),g=d(document).height();if(b+f>.8*g){if(e.css("left")=="-"+a.width+"px")switch(a.effect){case "fast":e.animate({left:a.left+"px"},100,function(){c.show()});break;case "slow":e.animate({left:a.left+"px"},1E3,function(){c.show()});break;case "veryslow":e.animate({left:a.left+
"px"},1E4,function(){c.show()});break;case "jump":e.css("bottom","-"+a.height+"px").css("left",a.left+"px");e.animate({bottom:0},300).animate({bottom:"-10px"},50).animate({bottom:0},50).animate({bottom:"-10px"},50).animate({bottom:0},300,function(){c.show()});break;case "sneaky":e.animate({left:"-"+.54*a.width+"px"},2E3).delay(2E3).animate({left:"-"+.6*a.width+"px"},1E3).delay(1E3).animate({left:"-"+.54*a.width+"px"},1E3).delay(2E3).animate({left:"-"+.7*a.width+"px"},2E3).delay(1E3).animate({left:a.left+
"px"},3E3,function(){c.show()});break;default:e.animate({left:a.left+"px"},500,function(){c.show()})}}else e.css("left")==a.left+"px"&&(c.hide(),e.animate({left:"-"+a.width+"px"},100),h(a))});b.click(function(){c.hide();e.animate({left:"-"+(a.width+10)+"px"},100)});f.click(function(){c.hide();h(a)})}})(jQuery);
