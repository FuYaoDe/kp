(function(c){function h(b){var a='<div id="kp_come_container" style="width:'+b.width+"px; height:"+b.height+"px; left:-"+b.width+'px; bottom:0;"><img src="'+b.image+'" style="width:'+b.width+"px; height:"+b.height+'px;"><div id="kp_popup" style="left:'+.8*b.width+"px;top:"+.28*b.height+'px;"><div id="kp_says">'+b.default_text+'</div><div id="kp_popup_arrow_shadow"></div><div id="kp_popup_arrow"></div><div id="kx_close_popup">X</div></div></div>';c("body").append(a);k(b)}function k(b){var a={},d;c.get(b.api,
function(e){var g=0;c.each(e.data,function(b,c){a[g]=c;g++});var f=a[Math.floor(Math.random()*(g-1))];link='<a href="'+f.url+'" target="_blank" class="kp_readmore">\u4e86\u89e3\u66f4\u591a\u67ef\u6587\u54f2\u7684\u653f\u898b</a>';e=f.title.replace(/\u3010\u67efp\u65b0\u653f\u3011/g,"");f=f.plain_content.replace(/\u67ef\u6587\u54f2/g,"\u6211").replace(/\u53f0\u5317\u5e02\u9577\u53c3\u9078\u4eba/g,"").replace(/\u6211\u8868\u793a/g,"\u6211\u8a8d\u70ba").replace(/\u6211\u6307\u51fa/g,"\u6211\u8a8d\u70ba").replace("\u4eca\uff0829\uff09\u65e5",
"").replace("\u300c","").replace("\u300d","").replace("\u67efP\u7684\u4e3b\u5f35\u6211\u7684\u653f\u7b56\u4e3b\u5f35","\u6211\u4e3b\u5f35");f=f.split("\n");d=void 0==f[1]?'<p id="kp_say_bighi">'+b.default_text+"<br>\u6211\u63d0\u51fa<br>\u300c"+e.substring(2)+"\u300d</p>"+link:'<p id="kp_say_hi">'+b.default_text+"</p>"+f[3]+f[4]+"..."+link+"</p>";c("#kp_says").scrollTop(0).html(d).promise().done(function(){c("p").removeAttr("style");c("span").removeAttr("style")})})}c.kptalks=function(b){var a=c.extend({image:"http://unlimited.kptaipei.tw/images/kp.png",
api:"http://api.kptaipei.tw/v1/category/40?accessToken=kp53f568e77303e9.28212837",default_text:"\u4f60\u597d\uff0c\u6211\u662f\u67ef\u6587\u54f2",effect:"default",height:450,width:466,left:-130},b);h(a);var d=c("#kp_come_container");b=c("#kp_come_container img");var e=c("#kp_popup"),g=c("#kx_close_popup");c(window).scroll(function(){var b=c(window).scrollTop(),g=c(window).height(),h=c(document).height();if(b+g>.8*h){if(d.css("left")=="-"+a.width+"px")switch(a.effect){case "fast":d.animate({left:a.left+
"px"},100,function(){e.show()});break;case "slow":d.animate({left:a.left+"px"},1E3,function(){e.show()});break;case "veryslow":d.animate({left:a.left+"px"},1E4,function(){e.show()});break;case "jump":d.css("bottom","-"+a.height+"px").css("left",a.left+"px");d.animate({bottom:0},300).animate({bottom:"-10px"},50).animate({bottom:0},50).animate({bottom:"-10px"},50).animate({bottom:0},300,function(){e.show()});break;case "sneaky":d.animate({left:"-"+.54*a.width+"px"},2E3).delay(2E3).animate({left:"-"+
.6*a.width+"px"},1E3).delay(1E3).animate({left:"-"+.54*a.width+"px"},1E3).delay(2E3).animate({left:"-"+.7*a.width+"px"},2E3).delay(1E3).animate({left:a.left+"px"},3E3,function(){e.show()});break;default:d.animate({left:a.left+"px"},500,function(){e.show()})}}else d.css("left")==a.left+"px"&&(e.hide(),d.animate({left:"-"+a.width+"px"},100),k(a))});b.click(function(){e.hide();d.animate({left:"-"+(a.width+10)+"px"},100)});g.click(function(){e.hide();k(a)})}})(jQuery);
